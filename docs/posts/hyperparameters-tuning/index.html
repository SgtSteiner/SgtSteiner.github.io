<!DOCTYPE html>
<html lang="es-ES">
    <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
    <meta charset="UTF-8" />

    <meta name="generator" content="Hugo 0.83.1" /><meta name="theme-color" content="#fff" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no" />
    
    <meta http-equiv="Cache-Control" content="no-transform" />
    
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Ajuste de hiperparámetros | Lords of the Machine Learning</title>

    <link rel="stylesheet" href="/css/meme.min.317d84c7f6754ad23a2ae219d212f73a900416875fb1144e27652ca955c5aac2.css"/>

    
    
        <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lunr-languages@1.4.0/min/lunr.stemmer.support.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lunr-languages@1.4.0/min/lunr.es.min.js" defer></script><script src="/js/meme.min.49400d21a299355489a0a02cf7737ef1e4e5fe75fe5bd16cd756376c2bb6b749.js"></script>

    

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM&#43;Plex&#43;Serif:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Comfortaa:wght@700&amp;display=swap" media="print" onload="this.media='all'" />
        <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM&#43;Plex&#43;Serif:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Comfortaa:wght@700&amp;display=swap" /></noscript>

    <meta name="author" content="Antonio Méndez" /><meta name="description" content="En posts anteriores vimos cómo crear, entrenar, predecir e incluso evaluar un modelo predictivo. Sin embargo, no cambiamos ninguno de los parámetros del modelo que tenemos a nuestra disposición cuando creamos una instancia. Por ejemplo, para k-nearest neighbors, inicialmente usamos los parámetros por defecto: n_neighbors=5 antes de probar otros parámetros del modelo." />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#2a6df4" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="Lords of the Machine Learning" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="Lords of the Machine Learning" />
    <meta name="msapplication-starturl" content="../../" />
    <meta name="msapplication-TileColor" content="#fff" />
    <meta name="msapplication-TileImage" content="../../icons/mstile-150x150.png" />
    <link rel="manifest" href="/manifest.json" />

    
    

    
    <link rel="canonical" href="https://sgtsteiner.github.io/posts/hyperparameters-tuning/" />
    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "datePublished": "2022-03-23T12:31:47+01:00",
        "dateModified": "2022-03-28T18:16:18+02:00",
        "url": "https://sgtsteiner.github.io/posts/hyperparameters-tuning/",
        "headline": "Ajuste de hiperparámetros",
        "description": "En posts anteriores vimos cómo crear, entrenar, predecir e incluso evaluar un modelo predictivo. Sin embargo, no cambiamos ninguno de los parámetros del modelo que tenemos a nuestra disposición cuando creamos una instancia. Por ejemplo, para k-nearest neighbors, inicialmente usamos los parámetros por defecto: n_neighbors=5 antes de probar otros parámetros del modelo.",
        "inLanguage" : "es-ES",
        "articleSection": "posts",
        "wordCount":  7094 ,
        "image": ["https://sgtsteiner.github.io/images/output_46_0.png","https://sgtsteiner.github.io/images/randomized_search.png","https://sgtsteiner.github.io/images/output_67_0.png","https://sgtsteiner.github.io/images/parallel_coordinates.png","https://sgtsteiner.github.io/images/kfold_cv.png","https://sgtsteiner.github.io/images/kf_cv_nested.png"],
        "author": {
            "@type": "Person",
            "description": "Sgt. Steiner",
            "email": "futitotal@gmail.com",
            "image": "https://sgtsteiner.github.io/icons/apple-touch-icon.png",
            "url": "https://sgtsteiner.github.io/",
            "name": "Antonio Méndez"
        },
        "license": "[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es)",
        "publisher": {
            "@type": "Organization",
            "name": "Lords of the Machine Learning",
            "logo": {
                "@type": "ImageObject",
                "url": "https://sgtsteiner.github.io/icons/apple-touch-icon.png"
            },
            "url": "https://sgtsteiner.github.io/"
        },
        "mainEntityOfPage": {
            "@type": "WebSite",
            "@id": "https://sgtsteiner.github.io/"
        }
    }
</script>

    

<meta name="twitter:card" content="summary_large_image" />


<meta name="twitter:site" content="@Steiner_69" />
<meta name="twitter:creator" content="@Steiner_69" />

    



<meta property="og:title" content="Ajuste de hiperparámetros" />
<meta property="og:description" content="En posts anteriores vimos cómo crear, entrenar, predecir e incluso evaluar un modelo predictivo. Sin embargo, no cambiamos ninguno de los parámetros del modelo que tenemos a nuestra disposición cuando creamos una instancia. Por ejemplo, para k-nearest neighbors, inicialmente usamos los parámetros por defecto: n_neighbors=5 antes de probar otros parámetros del modelo." />
<meta property="og:url" content="https://sgtsteiner.github.io/posts/hyperparameters-tuning/" />
<meta property="og:site_name" content="Lords of the Machine Learning" />
<meta property="og:locale" content="es" /><meta property="og:image" content="https://sgtsteiner.github.io/images/output_46_0.png" />
<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2022-03-23T12:31:47&#43;01:00" />
    <meta property="article:modified_time" content="2022-03-28T18:16:18&#43;02:00" />
    
    <meta property="article:section" content="posts" />



    
    

    
</head>

    <body>
        <div class="container">
            
    <header class="header">
        
            <div class="header-wrapper">
                <div class="header-inner single">
                    
    <div class="site-brand">
        
            <a href="/" class="brand">Lords of the Machine Learning</a>
        
    </div>

                    <nav class="nav">
    <ul class="menu" id="menu">
        
            
        
        
        
        
            
                <li class="menu-item"><a href="/posts/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon archive"><path d="M32 448c0 17.7 14.3 32 32 32h384c17.7 0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6 0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6 0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3 0 64v48c0 8.8 7.2 16 16 16h480c8.8 0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"/></svg><span class="menu-item-name">Posts</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon th"><path d="M149.333 56v80c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24h101.333c13.255 0 24 10.745 24 24zm181.334 240v-80c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256 0 24.001-10.745 24.001-24zm32-240v80c0 13.255 10.745 24 24 24H488c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24zm-32 80V56c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256 0 24.001-10.745 24.001-24zm-205.334 56H24c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24zM0 376v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm386.667-56H488c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zm0 160H488c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zM181.333 376v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24z"/></svg><span class="menu-item-name">Categories</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/tags/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="icon tags"><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg><span class="menu-item-name">Tags</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/about/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon user-circle"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg><span class="menu-item-name">About</span></a>
                </li>
            
        
            
                
                    
                    
                        <li class="menu-item">
                            <a id="theme-switcher" href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-light"><path d="M193.2 104.5l48.8-97.5a18 18 0 0128 0l48.8 97.5 103.4 -34.5a18 18 0 0119.8 19.8l-34.5 103.4l97.5 48.8a18 18 0 010 28l-97.5 48.8 34.5 103.4a18 18 0 01-19.8 19.8l-103.4-34.5-48.8 97.5a18 18 0 01-28 0l-48.8-97.5l-103.4 34.5a18 18 0 01-19.8-19.8l34.5-103.4-97.5-48.8a18 18 0 010-28l97.5-48.8-34.5-103.4a18 18 0 0119.8-19.8zM256 128a128 128 0 10.01 0M256 160a96 96 0 10.01 0"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-dark"><path d="M27 412a256 256 0 10154-407a11.5 11.5 0 00-5 20a201.5 201.5 0 01-134 374a11.5 11.5 0 00-15 13"/></svg></a>
                        </li>
                    
                
            
        
            
                
            
        
            
                <li class="menu-item search-item">
                        <form id="search" class="search" role="search">
    <label for="search-input"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon search-icon"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></label>
    <input type="search" id="search-input" class="search-input">
</form>

<template id="search-result" hidden>
    <article class="content post">
        <h2 class="post-title"><a class="summary-title-link"></a></h2>
        <summary class="summary"></summary>
        <div class="read-more-container">
            <a class="read-more-link"> »</a>
        </div>
    </article>
</template>

                    </li>
                
            
        
    </ul>
</nav>

                    
                </div>
            </div>
            
    <input type="checkbox" id="nav-toggle" aria-hidden="true" />
    <label for="nav-toggle" class="nav-toggle"></label>
    <label for="nav-toggle" class="nav-curtain"></label>


        
    </header>




            
            
    <main class="main single" id="main">
    <div class="main-inner">

        

        <article class="content post h-entry" data-small-caps="true" data-align="default" data-type="posts" data-toc-num="true">

            <h1 class="post-title p-name">Ajuste de hiperparámetros</h1>

            

            
                
            

            
                

<div class="post-meta">
    
        
        <time datetime="2022-03-23T12:31:47&#43;01:00" class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>&nbsp;23.3.2022</time>
    
    
        
        <time datetime="2022-03-28T18:16:18&#43;02:00" class="post-meta-item modified dt-updated"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M400 64h-48V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v52H160V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v52H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 400H54a6 6 0 0 1-6-6V160h352v298a6 6 0 0 1-6 6zm-52.849-200.65L198.842 404.519c-4.705 4.667-12.303 4.637-16.971-.068l-75.091-75.699c-4.667-4.705-4.637-12.303.068-16.971l22.719-22.536c4.705-4.667 12.303-4.637 16.97.069l44.104 44.461 111.072-110.181c4.705-4.667 12.303-4.637 16.971.068l22.536 22.718c4.667 4.705 4.636 12.303-.069 16.97z"/></svg>&nbsp;28.3.2022</time>
    
    
    
        
        
        
            
                <span class="post-meta-item category"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>&nbsp;<a href="/categories/tutoriales/" class="category-link p-category">tutoriales</a></span>
            
        
    
    
        
        <span class="post-meta-item wordcount"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;7094</span>
    
    
        
        <span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;34&nbsp;</span>
    
    
    
</div>

            

            <div class="post-body e-content">
              <p style="text-indent:0"><span class="drop-cap">E</span>n posts anteriores vimos cómo crear, entrenar, predecir e incluso evaluar un modelo predictivo. Sin embargo, no cambiamos ninguno de los parámetros del modelo que tenemos a nuestra disposición cuando creamos una instancia. Por ejemplo, para k-nearest neighbors, inicialmente usamos los parámetros por defecto: <code>n_neighbors=5</code> antes de probar otros parámetros del modelo.</p>
<p>Estos parámetros se denominan <strong>hiperparámetros</strong>: son parámetros usados para controlar el proceso de aprendizaje, por ejemplo el parámetro <code>k</code> de k-nearest neighbors. Los hiperparámetros son especificados por el usuario, a menudo ajustados manualmente (o por una búsqueda automática exhaustiva) y no pueden ser estimados a partir de los datos. No deben confundirse con los otros parámetros que son inferidos durante el proceso de entrenamiento. Estos parámetros definen el modelo en sí mismo, por ejemplo <code>coef_</code> para los modelos lineales.</p>
<p>En este post mostraremos en primer lugar que los hiperparámetros tienen un impacto en el rendimiento del modelo y que los valores por defecto no son necesariamente la mejor opción. Posteriormente, mostraremos cómo definir hiperparámetros en un modelo de scikit-learn. Por último, mostraremos estrategias que nos permitirán seleccionar una combinación de hiperparámetros que maximicen el rendimiento del modelo.</p>
<p>En concreto repasaremos los siguientes aspectos:</p>
<ul>
<li>cómo usar <code>get_params</code> y <code>set_params</code> para obtener los parámetros de un modelo y establecerlos, respectivamente;</li>
<li>cómo optimizar los hiperparámetros de un modelo predictivo a través de grid-search;</li>
<li>cómo la búsqueda de más de dos hiperparámetros es demasiado costosa;</li>
<li>cómo grid-search no encuentra necesariamente una solución óptima;</li>
<li>cómo la búsqueda aleatoria ofrece una buena alternativa a grid-search cuando el número de parámetros a ajustar es más de dos. También evita la regularidad impuesta por grid-search que puede resultar problemática en ocasiones;</li>
<li>cómo evaluar el rendimiento predictivo de un modelo con hiperparámetros ajustados usando el procedimiento de validación cruzada anidada.</li>
</ul>
<h1 id="establecer-y-obtener-hiperparámetros-en-scikit-learn"><a href="#establecer-y-obtener-hiperparámetros-en-scikit-learn" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Establecer y obtener hiperparámetros en scikit-learn</h1>
<p>El proceso de aprendizaje de un modelo predictivo es conducido por un conjunto de parámetros internos y un conjunto de datos de entrenamiento. Estos parámetros internos se denominan hiperparámetros y son específicos de cada familia de modelos. Además, un conjunto específico de hiperparámetros es óptimo para un dataset específico y, por lo tanto, necesitan optimizarse.</p>
<p>Vamos a mostrar como podemos obtener y establecer el valor de un hiperparámetro en un estimador de scikit-learn. Recordemos que los hiperparámetros se refieren a los parámetros que controlarán el proceso de aprendizaje. No debemos confundirlos con los parámetros entrenados, resultado del entrenamiento. Estos parámetros entrenados se reconocen en scikit-learn porque tienen el sufijo <code>_</code>, por ejemplo, <code>model_coef_</code>.</p>
<p>Utilizaremos el dataset del <a href="http://www.openml.org/d/1590" target="_blank" rel="noopener">Censo US de 1944</a>, del que únicamente usaremos las variables numéricas.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">adult_census</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;adult_census.csv&#34;</span><span class="p">)</span>

<span class="n">target_name</span> <span class="o">=</span> <span class="s2">&#34;class&#34;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">adult_census</span><span class="p">[</span><span class="n">target_name</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">adult_census</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_name</span><span class="p">])</span>

<span class="n">numerical_columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="s2">&#34;capital-gain&#34;</span><span class="p">,</span> <span class="s2">&#34;capital-loss&#34;</span><span class="p">,</span> <span class="s2">&#34;hours-per-week&#34;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">numerical_columns</span><span class="p">]</span>
<span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<div class="table-container"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>capital-gain</th>
      <th>capital-loss</th>
      <th>hours-per-week</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>25</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
    </tr>
    <tr>
      <th>1</th>
      <td>38</td>
      <td>0</td>
      <td>0</td>
      <td>50</td>
    </tr>
    <tr>
      <th>2</th>
      <td>28</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
    </tr>
    <tr>
      <th>3</th>
      <td>44</td>
      <td>7688</td>
      <td>0</td>
      <td>40</td>
    </tr>
    <tr>
      <th>4</th>
      <td>18</td>
      <td>0</td>
      <td>0</td>
      <td>30</td>
    </tr>
  </tbody>
</table></div>
</div>
<p>Vamos a crear un modelo predictivo simple compuesto por un scaler seguido por un clasificador de regresión logística.</p>
<p>Muchos modelos, incluidos los lineales, trabajan mejor si todas las características tienen un escalado similar. Para este propósito, usaremos un <code>StandardScaler</code>, que transforma los datos escalando las features.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&#34;diagram&#34;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&#34;preprocessor&#34;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&#34;classifier&#34;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())</span>
<span class="p">])</span></code></pre></div>
<p>Podemos evaluar el rendimiento de generalización del modelo a través de validación cruzada.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>

<span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;test_score&#34;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Puntuación de precisión a través de validación cruzada:</span><span class="se">\n</span><span class="s2">&#34;</span>
      <span class="n">f</span><span class="s2">&#34;{scores.mean():.3f} +/- {scores.std():.3f}&#34;</span><span class="p">)</span></code></pre></div>
<pre><code>Puntuación de precisión a través de validación cruzada:
0.800 +/- 0.003
</code></pre>
<p>Hemos creado un modelo con el valor por defecto de <code>C</code> que es igual a 1. Si quisiéramos usar un parámetro <code>C</code> distinto, podríamos haberlo hecho cuando creamos el objeto <code>LogisticRegression</code> con algo como <code>LogisticRegression(C=1e-3)</code>. También podemos cambiar el parámetro de un modelo después de que haya sido creado con el método <code>set_params</code>, disponible para todos los estimadores de scikit-learn. Por ejemplo, podemos establecer <code>C=1e-3</code>, entrenar y evaluar el modelo:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">classifier__C</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Puntuación de precisión a través de validación cruzada:</span><span class="se">\n</span><span class="s2">&#34;</span>
      <span class="n">f</span><span class="s2">&#34;{scores.mean():.3f} +/- {scores.std():.3f}&#34;</span><span class="p">)</span></code></pre></div>
<pre><code>Puntuación de precisión a través de validación cruzada:
0.800 +/- 0.003
</code></pre>
<p>Cuando el modelo está en un <code>Pipeline</code>, los nombres de los parámetros tiene la forma <code>&lt;nombre_modelo&gt;__&lt;nombre_parámetro&gt;</code>. En nuestro caso, <code>classifier</code> proviene de la definición del <code>Pipeline</code> y <code>C</code> es el nombre del parámetro de <code>LogisticRegression</code>.</p>
<p>Generalmente, podemos usar el método <code>get_params</code> en los modelos de scikit-learn para listar todos los parámetros con sus respectivos valores.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span></code></pre></div>
<pre><code>{'memory': None,
 'steps': [('preprocessor', StandardScaler()),
  ('classifier', LogisticRegression(C=0.001))],
 'verbose': False,
 'preprocessor': StandardScaler(),
 'classifier': LogisticRegression(C=0.001),
 'preprocessor__copy': True,
 'preprocessor__with_mean': True,
 'preprocessor__with_std': True,
 'classifier__C': 0.001,
 'classifier__class_weight': None,
 'classifier__dual': False,
 'classifier__fit_intercept': True,
 'classifier__intercept_scaling': 1,
 'classifier__l1_ratio': None,
 'classifier__max_iter': 100,
 'classifier__multi_class': 'auto',
 'classifier__n_jobs': None,
 'classifier__penalty': 'l2',
 'classifier__random_state': None,
 'classifier__solver': 'lbfgs',
 'classifier__tol': 0.0001,
 'classifier__verbose': 0,
 'classifier__warm_start': False}
</code></pre>
<p><code>get_params</code> devuelve un diccionario cuyas claves son los nombres de los parámetros y sus valores los valores de dichos parámetros. Si queremos obtener el valor de un único parámetro, por ejemplo, <code>classifier__C</code> usamos lo siguiente:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&#34;classifier__C&#34;</span><span class="p">]</span></code></pre></div>
<pre><code>0.001
</code></pre>
<p>Podemos variar sistemáticamente el valor de C para ver si existe un valor óptimo.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">classifier__C</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;test_score&#34;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Puntuación de precisión de validación cruzada con C={C}:</span><span class="se">\n</span><span class="s2">&#34;</span>
      <span class="n">f</span><span class="s2">&#34;{scores.mean():.3f} +/- {scores.std():.3f}&#34;</span><span class="p">)</span></code></pre></div>
<pre><code>Puntuación de precisión de validación cruzada con C=0.001:
0.787 +/- 0.002
Puntuación de precisión de validación cruzada con C=0.01:
0.799 +/- 0.003
Puntuación de precisión de validación cruzada con C=0.1:
0.800 +/- 0.003
Puntuación de precisión de validación cruzada con C=1:
0.800 +/- 0.003
Puntuación de precisión de validación cruzada con C=10:
0.800 +/- 0.003
</code></pre>
<p>Podemos ver que mientras C sea lo suficientemente alto, el modelo parece rendir bien.</p>
<p>Lo que hemos hecho aquí es muy manual: implica recorrer los valores de C y seleccionar manualmente el mejor. Veremos cómo realizar esta tarea de forma automática.</p>
<p>Cuando evaluamos una familia de modelos en datos de prueba y seleccionamos el que mejor se ejecuta, no podemos confiar en la correpondiente precisión de la estimación y necesitamos aplicar el modelo en nuevos datos. De hecho, los datos de prueba se han usado para seleccionar el modelo y, por lo tanto, ya no es independiente de este modelo.</p>
<h1 id="ajuste-de-hiperparámetros-por-grid-search"><a href="#ajuste-de-hiperparámetros-por-grid-search" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Ajuste de hiperparámetros por <em>grid-search</em></h1>
<p>Vamos a mostrar cómo optimizar hiperparámetros usando el enfoque de grid-search.</p>
<p>Seguimos con nuestro dataset del censo.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">target_name</span> <span class="o">=</span> <span class="s2">&#34;class&#34;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">adult_census</span><span class="p">[</span><span class="n">target_name</span><span class="p">]</span>
<span class="n">y</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></code></pre></div>
<pre><code>0     &lt;=50K
1     &lt;=50K
2      &gt;50K
3      &gt;50K
4     &lt;=50K
Name: class, dtype: object
</code></pre>
<p>Vamos a eliminar de nuestro datos el objetivo y la columna <code>&quot;education-num&quot;</code>, dado que es información duplicada de la columna <code>&quot;education&quot;</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">X</span> <span class="o">=</span> <span class="n">adult_census</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_name</span><span class="p">,</span> <span class="s2">&#34;education-num&#34;</span><span class="p">])</span>
<span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<div class="table-container"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>fnlwgt</th>
      <th>education</th>
      <th>marital-status</th>
      <th>occupation</th>
      <th>relationship</th>
      <th>race</th>
      <th>sex</th>
      <th>capital-gain</th>
      <th>capital-loss</th>
      <th>hours-per-week</th>
      <th>native-country</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>25</td>
      <td>Private</td>
      <td>226802</td>
      <td>11th</td>
      <td>Never-married</td>
      <td>Machine-op-inspct</td>
      <td>Own-child</td>
      <td>Black</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
    </tr>
    <tr>
      <th>1</th>
      <td>38</td>
      <td>Private</td>
      <td>89814</td>
      <td>HS-grad</td>
      <td>Married-civ-spouse</td>
      <td>Farming-fishing</td>
      <td>Husband</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>50</td>
      <td>United-States</td>
    </tr>
    <tr>
      <th>2</th>
      <td>28</td>
      <td>Local-gov</td>
      <td>336951</td>
      <td>Assoc-acdm</td>
      <td>Married-civ-spouse</td>
      <td>Protective-serv</td>
      <td>Husband</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
    </tr>
    <tr>
      <th>3</th>
      <td>44</td>
      <td>Private</td>
      <td>160323</td>
      <td>Some-college</td>
      <td>Married-civ-spouse</td>
      <td>Machine-op-inspct</td>
      <td>Husband</td>
      <td>Black</td>
      <td>Male</td>
      <td>7688</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
    </tr>
    <tr>
      <th>4</th>
      <td>18</td>
      <td>?</td>
      <td>103497</td>
      <td>Some-college</td>
      <td>Never-married</td>
      <td>?</td>
      <td>Own-child</td>
      <td>White</td>
      <td>Female</td>
      <td>0</td>
      <td>0</td>
      <td>30</td>
      <td>United-States</td>
    </tr>
  </tbody>
</table></div>
</div>
<p>Dividimos el dataset en entrenamiento y prueba.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span></code></pre></div>
<p>Vamos a definir un pipeline y manejaremos tanto las variables numéricas como las categóricas.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_selector</span> <span class="k">as</span> <span class="n">selector</span>

<span class="n">categorical_columns_selector</span> <span class="o">=</span> <span class="n">selector</span><span class="p">(</span><span class="n">dtype_include</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
<span class="n">categorical_columns</span> <span class="o">=</span> <span class="n">categorical_columns_selector</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code></pre></div>
<p>En este caso, estamos usando un modelo basado en árbol como un clasificador (es decir, <code>HistGradientBoostingClassifier</code>). Esto significa que:</p>
<ul>
<li>las variables numéricas no necesitan escalado;</li>
<li>las variables categóricas se pueden manejar con un <code>OrdinalEncoder</code> incluso si el orden codificado no tiene sentido;</li>
<li>En los modelos basados en árbol, <code>OrdinalEncoder</code> evita tener representaciones de alta dimensionalidad.</li>
</ul>
<p>Vamos a construir nuestro <code>OrdinalEncoder</code> pasándole las categorías conocidas.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>

<span class="n">categorical_preprocessor</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&#34;use_encoded_value&#34;</span><span class="p">,</span>
                                          <span class="n">unknown_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code></pre></div>
<p>Usaremos un <code>ColumnTransformer</code> para seleccionar las columnas categóricas y aplicarles el <code>OrdinalEncoder</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&#34;cat_preprocessor&#34;</span><span class="p">,</span> <span class="n">categorical_preprocessor</span><span class="p">,</span> <span class="n">categorical_columns</span><span class="p">)],</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s2">&#34;passthrough&#34;</span><span class="p">,</span> <span class="n">sparse_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code></pre></div>
<p>Por último, usaremos un clasificador de árbol (por ejemplo, <em>histogram gradient-boosting</em>) para predecir si una persona gana más de 50 k$ al año.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">HistGradientBoostingClassifier</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&#34;preprocessor&#34;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&#34;classifier&#34;</span><span class="p">,</span> <span class="n">HistGradientBoostingClassifier</span><span class="p">(</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">max_leaf_nodes</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">))</span>
<span class="p">])</span>
<span class="n">model</span></code></pre></div>
<style>#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 {color: black;background-color: white;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 pre{padding: 0;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-toggleable {background-color: white;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-estimator:hover {background-color: #d4ebff;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-item {z-index: 1;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-parallel-item:only-child::after {width: 0;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-bfa4b090-bb0e-4721-afa1-b8867206ea58 div.sk-text-repr-fallback {display: none;}</style><div id="sk-bfa4b090-bb0e-4721-afa1-b8867206ea58" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1), [&#x27;workclass&#x27;, &#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;,&#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,HistGradientBoostingClassifier(max_leaf_nodes=4,random_state=42))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="820085ec-5b92-4bee-873e-6726debea34c" type="checkbox" ><label for="820085ec-5b92-4bee-873e-6726debea34c" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;,&#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,HistGradientBoostingClassifier(max_leaf_nodes=4,random_state=42))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d4538111-be48-4cc7-af38-39fccedf57e2" type="checkbox" ><label for="d4538111-be48-4cc7-af38-39fccedf57e2" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="45ccddd5-1f11-42fd-b0e2-c40787a4b44c" type="checkbox" ><label for="45ccddd5-1f11-42fd-b0e2-c40787a4b44c" class="sk-toggleable__label sk-toggleable__label-arrow">cat_preprocessor</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;, &#x27;native-country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f20179c5-b176-4e8b-a541-4377917be797" type="checkbox" ><label for="f20179c5-b176-4e8b-a541-4377917be797" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;, unknown_value=-1)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="66dee3d8-b3ff-4dbd-b15f-afd508e44956" type="checkbox" ><label for="66dee3d8-b3ff-4dbd-b15f-afd508e44956" class="sk-toggleable__label sk-toggleable__label-arrow">remainder</label><div class="sk-toggleable__content"><pre></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0e61c6de-dc28-4d07-8684-14e776da4bf0" type="checkbox" ><label for="0e61c6de-dc28-4d07-8684-14e776da4bf0" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c6b34bd5-2a99-4e27-8881-bb37f7939bce" type="checkbox" ><label for="c6b34bd5-2a99-4e27-8881-bb37f7939bce" class="sk-toggleable__label sk-toggleable__label-arrow">HistGradientBoostingClassifier</label><div class="sk-toggleable__content"><pre>HistGradientBoostingClassifier(max_leaf_nodes=4, random_state=42)</pre></div></div></div></div></div></div></div>
<p>Pasemos ahora al ajuste con grid-search. Anteriormente usamos un bucle <code>for</code> para cada hiperparámetro con el fin de encontrar la mejor combinación a partir de un conjunto de valores. La clase <code>GridSearchCV</code> de scikit-learn implementa una lógica muy similar con mucho menos código repetitivo. Vamos a ver cómo usar el estimador <code>GridSearchCV</code> para realizar esta búsqueda. Dado que grid-search puede ser costoso, únicamente exploraremos la combinación tasa de aprendizaje y máximo número de nodos.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&#34;classifier__learning_rate&#34;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s2">&#34;classifier__max_leaf_nodes&#34;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)}</span>
<span class="n">model_grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
                                 <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">model_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span></code></pre></div>
<pre><code>CPU times: total: 14.3 s
Wall time: 5.51 s
</code></pre>
<style>#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 {color: black;background-color: white;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 pre{padding: 0;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-toggleable {background-color: white;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-item {z-index: 1;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-parallel-item:only-child::after {width: 0;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-9b70fb2d-44a4-4963-afbb-8a2c6bac99a3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=2,estimator=Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;,sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;,&#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;,&#x27;relationship&#x27;,&#x27;race&#x27;,&#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,HistGradientBoostingClassifier(max_leaf_nodes=4,random_state=42))]),n_jobs=-1,param_grid={&#x27;classifier__learning_rate&#x27;: (0.01, 0.1, 1, 10),&#x27;classifier__max_leaf_nodes&#x27;: (3, 10, 30)})</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="80e416b7-11ab-4602-b188-1dcd00dc20eb" type="checkbox" ><label for="80e416b7-11ab-4602-b188-1dcd00dc20eb" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=2,estimator=Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;,sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;,&#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;,&#x27;relationship&#x27;,&#x27;race&#x27;,&#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,HistGradientBoostingClassifier(max_leaf_nodes=4,random_state=42))]),n_jobs=-1,param_grid={&#x27;classifier__learning_rate&#x27;: (0.01, 0.1, 1, 10),&#x27;classifier__max_leaf_nodes&#x27;: (3, 10, 30)})</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ca9506ba-28e6-4a36-8103-106d6e6d5e33" type="checkbox" ><label for="ca9506ba-28e6-4a36-8103-106d6e6d5e33" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0026db78-2776-471a-9600-d6f56a04f50d" type="checkbox" ><label for="0026db78-2776-471a-9600-d6f56a04f50d" class="sk-toggleable__label sk-toggleable__label-arrow">cat_preprocessor</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;, &#x27;native-country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="97530e35-4ede-416e-affa-a4f7c3de14a2" type="checkbox" ><label for="97530e35-4ede-416e-affa-a4f7c3de14a2" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;, unknown_value=-1)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b526a3b7-55ec-448b-898e-f4cba1e3c48b" type="checkbox" ><label for="b526a3b7-55ec-448b-898e-f4cba1e3c48b" class="sk-toggleable__label sk-toggleable__label-arrow">remainder</label><div class="sk-toggleable__content"><pre></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a8fe2b9f-1537-467e-b6b4-096e4c01202d" type="checkbox" ><label for="a8fe2b9f-1537-467e-b6b4-096e4c01202d" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="15e715f3-9c90-493f-b50e-56dc2074a9f4" type="checkbox" ><label for="15e715f3-9c90-493f-b50e-56dc2074a9f4" class="sk-toggleable__label sk-toggleable__label-arrow">HistGradientBoostingClassifier</label><div class="sk-toggleable__content"><pre>HistGradientBoostingClassifier(max_leaf_nodes=4, random_state=42)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
<p>Finalmente, comprobamos la precisión de nuestro modelo usando el conjunto de prueba.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">accuracy</span> <span class="o">=</span> <span class="n">model_grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;La puntuación de precisión de prueba del pipeline grid-search es:&#34;</span>
      <span class="n">f</span><span class="s2">&#34;{accuracy:.2f}&#34;</span><span class="p">)</span></code></pre></div>
<pre><code>La puntuación de precisión de prueba del pipeline grid-search es:0.88
</code></pre>
<p>El estimador <code>GridSearchCV</code> toma una parámetro <code>param_grid</code> que define todos los hiperparámetros y sus valores asociados. Grid-search se encargará de crear todas las posibles combinaciones y probarlas.</p>
<p>El número de combinaciones será igual al producto del número de valores a explorar para cada parámetros (es decir, en nuestro ejemplo 4 x 3 combinaciones). Por tanto, añadir nuevos parámetros con sus valores asociados a ser explorados se vuelve rápidamente computacionalmente costoso.</p>
<p>Una vez que grid-search es entrenado, se puede usar como cualquier otro predictor llamando a sus métodos <code>predict</code> y <code>predict_proba</code>. Internamente, usará el modelo con los mejores parámetros encontrados durante el <code>fit</code>.</p>
<p>Vamos a obtener las predicciones para los primeros 5 ejemplos usando el estimador con los mejores parámetros.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model_grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span></code></pre></div>
<pre><code>array([' &lt;=50K', ' &lt;=50K', ' &gt;50K', ' &lt;=50K', ' &gt;50K'], dtype=object)
</code></pre>
<p>Podemos conocer cuáles son esos parámetros mirando el atributo <code>best_params_</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model_grid_search</span><span class="o">.</span><span class="n">best_params_</span></code></pre></div>
<pre><code>{'classifier__learning_rate': 0.1, 'classifier__max_leaf_nodes': 30}
</code></pre>
<p>La precisión y los mejores parámetros del pipeline de grid-search son similares a los que encontramos anteriormente, donde localizamos los mejores parámetros &ldquo;a mano&rdquo; usando un doble bucle for. Además, podemos inspeccionar todos los resultados, los cuales se almacenan en el atributo <code>cv_results_</code> de grid-search. Filtraremos algunas columnas específicas de estos resultados.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">cv_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">model_grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="s2">&#34;mean_test_score&#34;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">cv_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<div class="table-container"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_score_time</th>
      <th>std_score_time</th>
      <th>param_classifier__learning_rate</th>
      <th>param_classifier__max_leaf_nodes</th>
      <th>params</th>
      <th>split0_test_score</th>
      <th>split1_test_score</th>
      <th>mean_test_score</th>
      <th>std_test_score</th>
      <th>rank_test_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>1.032387</td>
      <td>4.768372e-07</td>
      <td>0.214684</td>
      <td>0.006005</td>
      <td>0.1</td>
      <td>30</td>
      <td>{'classifier__learning_rate': 0.1, 'classifier...</td>
      <td>0.867766</td>
      <td>0.867649</td>
      <td>0.867708</td>
      <td>0.000058</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.762404</td>
      <td>4.478788e-02</td>
      <td>0.288248</td>
      <td>0.020517</td>
      <td>0.1</td>
      <td>10</td>
      <td>{'classifier__learning_rate': 0.1, 'classifier...</td>
      <td>0.866729</td>
      <td>0.866557</td>
      <td>0.866643</td>
      <td>0.000086</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.374071</td>
      <td>4.829156e-02</td>
      <td>0.169396</td>
      <td>0.021768</td>
      <td>1</td>
      <td>3</td>
      <td>{'classifier__learning_rate': 1, 'classifier__...</td>
      <td>0.860559</td>
      <td>0.861261</td>
      <td>0.860910</td>
      <td>0.000351</td>
      <td>3</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.241707</td>
      <td>8.007050e-03</td>
      <td>0.133865</td>
      <td>0.009759</td>
      <td>1</td>
      <td>10</td>
      <td>{'classifier__learning_rate': 1, 'classifier__...</td>
      <td>0.857993</td>
      <td>0.861862</td>
      <td>0.859927</td>
      <td>0.001934</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.545218</td>
      <td>5.529642e-02</td>
      <td>0.250966</td>
      <td>0.017766</td>
      <td>0.1</td>
      <td>3</td>
      <td>{'classifier__learning_rate': 0.1, 'classifier...</td>
      <td>0.852752</td>
      <td>0.854272</td>
      <td>0.853512</td>
      <td>0.000760</td>
      <td>5</td>
    </tr>
  </tbody>
</table></div>
</div>
<p>Con solo dos parámetros podriamos visualizar el grid-search con un mapa de calor. Necesitamos transformar nuestro <code>cv_results</code> en un dataframe donde:</p>
<ul>
<li>las filas corresponderán a los valores de la tasa de aprendizaje;</li>
<li>las columnas corresponderán al mnúmero máximo de hojas;</li>
<li>el contenido del dataframe serán las puntuaciones de prueba medias.</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pivoted_cv_results</span> <span class="o">=</span> <span class="n">cv_results</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">values</span><span class="o">=</span><span class="s2">&#34;mean_test_score&#34;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;param_classifier__learning_rate&#39;</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;param_classifier__max_leaf_nodes&#34;</span><span class="p">])</span>
<span class="n">pivoted_cv_results</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<div class="table-container"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>param_classifier__max_leaf_nodes</th>
      <th>3</th>
      <th>10</th>
      <th>30</th>
    </tr>
    <tr>
      <th>param_classifier__learning_rate</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.01</th>
      <td>0.797166</td>
      <td>0.817832</td>
      <td>0.845541</td>
    </tr>
    <tr>
      <th>0.10</th>
      <td>0.853512</td>
      <td>0.866643</td>
      <td>0.867708</td>
    </tr>
    <tr>
      <th>1.00</th>
      <td>0.860910</td>
      <td>0.859927</td>
      <td>0.851547</td>
    </tr>
    <tr>
      <th>10.00</th>
      <td>0.283476</td>
      <td>0.618080</td>
      <td>0.351642</td>
    </tr>
  </tbody>
</table></div>
</div>
<p>Podemos usa una representación de mapa de calor para mostrar visualmente el dataframe anterior.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">pivoted_cv_results</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&#34;YlGnBu&#34;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                 <span class="n">vmax</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span></code></pre></div>
<p><img src="/images/output_46_0.png" alt="png"></p>
<p>Observando el mapa de calor podemos resaltar algunas cosas:</p>
<ul>
<li>Para valores muy altos de <code>learning_rate</code>, el rendimiento de generalización del modelo se degrada y ajustar el valor de <code>max_leaf_nodes</code> no arregla el problema;</li>
<li>fuera de esta región problemática, observamos que la opción óptima de <code>max_leaf_nodes</code> depende del valor de <code>learning_rate</code>;</li>
<li>en particular, observamos una &ldquo;diagonal&rdquo; de buenos modelos con una precisión cercana al máximo de 0.87: cuando el valor de <code>max_leaf_nodes</code> se incrementa, debemos disminuir el valor de <code>learning_rate</code> acordemente para mantener una buena precisión.</li>
</ul>
<p>Por ahora, tengamos en cuenta que, en general, <strong>no existe una única configuración óptima de parámetros</strong>: 4 modelos de las 12 configuraciones de parámetros alcanzan la máxima precisión (hasta pequeñas fluctuaciones aleatorias causadas por el muestreo del conjunto de entrenamiento).</p>
<h1 id="ajuste-de-hiperparámetros-por-randomized-search"><a href="#ajuste-de-hiperparámetros-por-randomized-search" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Ajuste de hiperparámetros por <em>randomized-search</em></h1>
<p>Hemos visto que el enfoque de grid-search tiene sus limitaciones. No escala cuando el número de parámetros a ajustar aumenta. Además, grid-search impone una regularidad durante la búsqueda que podría ser problemática. Vamos a presentar otro método para ajustar hiperparámetros denominado búsqueda aleatoria.</p>
<p>Partimos del mismo dataset, el cual hemos dividido en entrenamiento y prueba, y hemos realizado el mismo pipeline de preprocesado.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span></code></pre></div>
<style>#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a {color: black;background-color: white;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a pre{padding: 0;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-toggleable {background-color: white;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-estimator:hover {background-color: #d4ebff;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-item {z-index: 1;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-parallel-item:only-child::after {width: 0;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a div.sk-text-repr-fallback {display: none;}</style><div id="sk-1fa48bfd-9d1b-43f1-b949-c6f9c13aff1a" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;,sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;,&#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,HistGradientBoostingClassifier(max_leaf_nodes=4,random_state=42))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7e48de5e-8168-4835-b69c-9ec24673ba5e" type="checkbox" ><label for="7e48de5e-8168-4835-b69c-9ec24673ba5e" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;,&#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,HistGradientBoostingClassifier(max_leaf_nodes=4,random_state=42))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fb66a536-f88c-46e9-9efe-dc3d9686d310" type="checkbox" ><label for="fb66a536-f88c-46e9-9efe-dc3d9686d310" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ae3c149c-f963-4280-a7dd-9caca9c7dbd8" type="checkbox" ><label for="ae3c149c-f963-4280-a7dd-9caca9c7dbd8" class="sk-toggleable__label sk-toggleable__label-arrow">cat_preprocessor</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;, &#x27;native-country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c1714508-41f1-41e2-a3f3-0eb8bb34417d" type="checkbox" ><label for="c1714508-41f1-41e2-a3f3-0eb8bb34417d" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;, unknown_value=-1)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d48a6f83-055d-496b-86cd-54d0851a5179" type="checkbox" ><label for="d48a6f83-055d-496b-86cd-54d0851a5179" class="sk-toggleable__label sk-toggleable__label-arrow">remainder</label><div class="sk-toggleable__content"><pre></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="dd040672-ebbe-4422-9bb5-d6a4c819862c" type="checkbox" ><label for="dd040672-ebbe-4422-9bb5-d6a4c819862c" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5da80bc8-f247-45f3-8c48-9b392bf77693" type="checkbox" ><label for="5da80bc8-f247-45f3-8c48-9b392bf77693" class="sk-toggleable__label sk-toggleable__label-arrow">HistGradientBoostingClassifier</label><div class="sk-toggleable__content"><pre>HistGradientBoostingClassifier(max_leaf_nodes=4, random_state=42)</pre></div></div></div></div></div></div></div>
<p>Con el estimador <code>GridSearchCV</code>, los parámetros necesitan ser explicitamente especificados. Ya mencionamos que explorar un gran número de valores para diferentes valores sería rápidamente intratable. En su lugar, podemos generar aleatoriamente parámetros candidatos. De hecho, este enfoque evita la regularidad de grid-search. Por tanto, agregar más evaluaciones puede aumentar la resolución en cada dirección. Este es el caso de la frecuente situación en la que la elección de algunos hiperparámetros no es muy importante, como ocurre con el hiperparámetro 2 del siguiente diagrama.</p>
<p><img src="/images/randomized_search.png" alt=""></p>
<p>De hecho, el número de puntos de evaluación debe ser dividido entre los dos diferentes hiperparámetros. Con un grid-search, el peligro es que esta región de buenos hiperparámetros quede entre la línea del grid: esta región está alineada con el grid dado que el hiperparámetro 2 tiene una influencia débil. Por contra, la búsqueda estocástica muestreará el hiperparámetro 1 independientemente del hiperparámetro 2 y buscará la región óptima.</p>
<p>La clase <code>RandomizedSearchCV</code> permite esta búsqueda estocástica. Se usa de forma similar a <code>GridSearchCV</code> pero se necesitan especificar las distribuciones de muestreo en lugar de los valores de los parámetros. Por ejemplo, dibujaremos candidatos usando una distribución logarítmica uniforme porque los parámetros que nos interesan toman valores posivos con una escala logarítmica natural (.1 es tan cercano a 1 como éste lo es a 10).</p>
<p>Normalmente, para optimizar 3 o más hiperparámetros, la búsqueda aleatoria es más beneficiosa que grid-search.</p>
<p>Optimizaremos otros 3 parámetros además de los que ya optimizamos con grid-search:</p>
<ul>
<li><code>l2_regularization</code>: corresponde con la fortaleza de la regularización;</li>
<li><code>min_samples_leaf</code>: corresponde con el número mínimo de muestras requerida en una hoja;</li>
<li><code>max_bins</code>: corresponde con el número máximo de contenedores para construir histogramas.</li>
</ul>
<p>Podemos usar <code>scipy.stats.loguniform</code> para generar números flotantes. Para generar valores aleatorios para parámetros con valores enteros (por ejemplo, <code>min_samples_leaf</code>) podemos adaptarlo como sigue:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">loguniform</span>

<span class="k">class</span> <span class="nc">loguniform_int</span><span class="p">:</span>
    <span class="s2">&#34;&#34;&#34;versión para valores enteror de la distribución log-uniform&#34;&#34;&#34;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distribution</span> <span class="o">=</span> <span class="n">loguniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;Ejemplo de variable aleatoria&#34;&#34;&#34;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distribution</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></code></pre></div>
<p>Ahora podemos definir la búsqueda aleatoria usando diferentes distribuciones. Ejecutar 10 iteraciones de 5-particiones de validación cruzada para parametrizaciones aleatorias de este modelo en este dataset puede llevar desde 10 segundos a varios minutos, dependiendo de la velocidad de la máquina y del número de procesadores disponibles.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>

<span class="n">param_distributions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__l2_regularization&#39;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">),</span>
    <span class="s1">&#39;classifier__learning_rate&#39;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;classifier__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="n">loguniform_int</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
    <span class="s1">&#39;classifier__min_samples_leaf&#39;</span><span class="p">:</span> <span class="n">loguniform_int</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;classifier__max_bins&#39;</span><span class="p">:</span> <span class="n">loguniform_int</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">model_random_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_distributions</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">model_random_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span></code></pre></div>
<pre><code>Fitting 5 folds for each of 10 candidates, totalling 50 fits
CPU times: total: 4.31 s
Wall time: 7.23 s
</code></pre>
<style>#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced {color: black;background-color: white;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced pre{padding: 0;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-toggleable {background-color: white;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-estimator:hover {background-color: #d4ebff;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-item {z-index: 1;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-parallel-item:only-child::after {width: 0;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced div.sk-text-repr-fallback {display: none;}</style><div id="sk-5fc71a5d-1746-48f6-a3f4-0b91ba882ced" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomizedSearchCV(cv=5,estimator=Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;,sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;,&#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;,&#x27;relationship&#x27;,&#x27;race&#x27;,&#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,Hi...&#x27;classifier__learning_rate&#x27;: &lt;scipy.stats._distn_infrastructure.rv_frozen object at 0x0000023201C853F0&gt;,&#x27;classifier__max_bins&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C86110&gt;,&#x27;classifier__max_leaf_nodes&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C86020&gt;,&#x27;classifier__min_samples_leaf&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C844F0&gt;},verbose=1)</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f79df122-00b0-4716-8860-2d88fb39dd9f" type="checkbox" ><label for="f79df122-00b0-4716-8860-2d88fb39dd9f" class="sk-toggleable__label sk-toggleable__label-arrow">RandomizedSearchCV</label><div class="sk-toggleable__content"><pre>RandomizedSearchCV(cv=5,estimator=Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;,sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;,&#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;,&#x27;relationship&#x27;,&#x27;race&#x27;,&#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,Hi...&#x27;classifier__learning_rate&#x27;: &lt;scipy.stats._distn_infrastructure.rv_frozen object at 0x0000023201C853F0&gt;,&#x27;classifier__max_bins&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C86110&gt;,&#x27;classifier__max_leaf_nodes&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C86020&gt;,&#x27;classifier__min_samples_leaf&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C844F0&gt;},verbose=1)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2e9618ad-50fc-4702-8035-01f8100e512e" type="checkbox" ><label for="2e9618ad-50fc-4702-8035-01f8100e512e" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6a84eb36-040c-45c0-b91c-6b412f1a14e6" type="checkbox" ><label for="6a84eb36-040c-45c0-b91c-6b412f1a14e6" class="sk-toggleable__label sk-toggleable__label-arrow">cat_preprocessor</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;, &#x27;native-country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fcd82118-70d1-479a-8db4-95796e9871ba" type="checkbox" ><label for="fcd82118-70d1-479a-8db4-95796e9871ba" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;, unknown_value=-1)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bff29f77-ac91-42f1-86aa-07a124f1548e" type="checkbox" ><label for="bff29f77-ac91-42f1-86aa-07a124f1548e" class="sk-toggleable__label sk-toggleable__label-arrow">remainder</label><div class="sk-toggleable__content"><pre></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="22b2cb47-edd6-4818-8375-3644f9ae8a22" type="checkbox" ><label for="22b2cb47-edd6-4818-8375-3644f9ae8a22" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8894a2b6-365a-475a-9eba-5199ad212a48" type="checkbox" ><label for="8894a2b6-365a-475a-9eba-5199ad212a48" class="sk-toggleable__label sk-toggleable__label-arrow">HistGradientBoostingClassifier</label><div class="sk-toggleable__content"><pre>HistGradientBoostingClassifier(max_leaf_nodes=4, random_state=42)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
<p>Después podemos calcular la puntuación de precisión en el conjunto de prueba.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">accuracy</span> <span class="o">=</span> <span class="n">model_random_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;La puntuación de precisión de prueba del mejor modelo es:&#34;</span>
      <span class="n">f</span><span class="s2">&#34;{accuracy:.2f}&#34;</span><span class="p">)</span></code></pre></div>
<pre><code>La puntuación de precisión de prueba del mejor modelo es:0.87
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model_random_search</span><span class="o">.</span><span class="n">best_params_</span></code></pre></div>
<pre><code>{'classifier__l2_regularization': 0.0006474800575651534,
 'classifier__learning_rate': 0.9584980078111938,
 'classifier__max_bins': 131,
 'classifier__max_leaf_nodes': 23,
 'classifier__min_samples_leaf': 98}
</code></pre>
<p>Como ya vimos, podemos inspeccionar los resultados usando el atributo <code>cv_results</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">cv_results</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<div class="table-container"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_score_time</th>
      <th>std_score_time</th>
      <th>param_classifier__learning_rate</th>
      <th>param_classifier__max_leaf_nodes</th>
      <th>params</th>
      <th>split0_test_score</th>
      <th>split1_test_score</th>
      <th>mean_test_score</th>
      <th>std_test_score</th>
      <th>rank_test_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>1.032387</td>
      <td>4.768372e-07</td>
      <td>0.214684</td>
      <td>0.006005</td>
      <td>0.1</td>
      <td>30</td>
      <td>{'classifier__learning_rate': 0.1, 'classifier...</td>
      <td>0.867766</td>
      <td>0.867649</td>
      <td>0.867708</td>
      <td>0.000058</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.762404</td>
      <td>4.478788e-02</td>
      <td>0.288248</td>
      <td>0.020517</td>
      <td>0.1</td>
      <td>10</td>
      <td>{'classifier__learning_rate': 0.1, 'classifier...</td>
      <td>0.866729</td>
      <td>0.866557</td>
      <td>0.866643</td>
      <td>0.000086</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.374071</td>
      <td>4.829156e-02</td>
      <td>0.169396</td>
      <td>0.021768</td>
      <td>1</td>
      <td>3</td>
      <td>{'classifier__learning_rate': 1, 'classifier__...</td>
      <td>0.860559</td>
      <td>0.861261</td>
      <td>0.860910</td>
      <td>0.000351</td>
      <td>3</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.241707</td>
      <td>8.007050e-03</td>
      <td>0.133865</td>
      <td>0.009759</td>
      <td>1</td>
      <td>10</td>
      <td>{'classifier__learning_rate': 1, 'classifier__...</td>
      <td>0.857993</td>
      <td>0.861862</td>
      <td>0.859927</td>
      <td>0.001934</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.545218</td>
      <td>5.529642e-02</td>
      <td>0.250966</td>
      <td>0.017766</td>
      <td>0.1</td>
      <td>3</td>
      <td>{'classifier__learning_rate': 0.1, 'classifier...</td>
      <td>0.852752</td>
      <td>0.854272</td>
      <td>0.853512</td>
      <td>0.000760</td>
      <td>5</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.309014</td>
      <td>1.376224e-02</td>
      <td>0.131613</td>
      <td>0.006506</td>
      <td>1</td>
      <td>30</td>
      <td>{'classifier__learning_rate': 1, 'classifier__...</td>
      <td>0.849749</td>
      <td>0.853344</td>
      <td>0.851547</td>
      <td>0.001798</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.302117</td>
      <td>5.504763e-02</td>
      <td>0.221190</td>
      <td>0.011009</td>
      <td>0.01</td>
      <td>30</td>
      <td>{'classifier__learning_rate': 0.01, 'classifie...</td>
      <td>0.843252</td>
      <td>0.847830</td>
      <td>0.845541</td>
      <td>0.002289</td>
      <td>7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.884009</td>
      <td>4.879224e-02</td>
      <td>0.331785</td>
      <td>0.014512</td>
      <td>0.01</td>
      <td>10</td>
      <td>{'classifier__learning_rate': 0.01, 'classifie...</td>
      <td>0.818956</td>
      <td>0.816708</td>
      <td>0.817832</td>
      <td>0.001124</td>
      <td>8</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.568239</td>
      <td>5.479753e-02</td>
      <td>0.272483</td>
      <td>0.028774</td>
      <td>0.01</td>
      <td>3</td>
      <td>{'classifier__learning_rate': 0.01, 'classifie...</td>
      <td>0.797882</td>
      <td>0.796451</td>
      <td>0.797166</td>
      <td>0.000715</td>
      <td>9</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.200672</td>
      <td>2.001750e-02</td>
      <td>0.090077</td>
      <td>0.011010</td>
      <td>10</td>
      <td>10</td>
      <td>{'classifier__learning_rate': 10, 'classifier_...</td>
      <td>0.742356</td>
      <td>0.493803</td>
      <td>0.618080</td>
      <td>0.124277</td>
      <td>10</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.177403</td>
      <td>1.376188e-02</td>
      <td>0.084322</td>
      <td>0.009258</td>
      <td>10</td>
      <td>30</td>
      <td>{'classifier__learning_rate': 10, 'classifier_...</td>
      <td>0.364545</td>
      <td>0.338739</td>
      <td>0.351642</td>
      <td>0.012903</td>
      <td>11</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.214183</td>
      <td>5.004406e-03</td>
      <td>0.123356</td>
      <td>0.020768</td>
      <td>10</td>
      <td>3</td>
      <td>{'classifier__learning_rate': 10, 'classifier_...</td>
      <td>0.279701</td>
      <td>0.287251</td>
      <td>0.283476</td>
      <td>0.003775</td>
      <td>12</td>
    </tr>
  </tbody>
</table></div>
</div>
<p>Tengamos en mente que este ajuste está limitado por el número de combinaciones diferentes de parámetros que se puntúan mediante búsqueda aleatoria. De hecho, puede haber otros conjuntos de parámetros que conduzcan a un similar o mejor rendimiento de generalización pero que no hayan sido probados en la búsqueda. En la práctica, la búsqueda aleatoria de hiperparámetros se ejecuta con un gran número de iteraciones. Para evitar el coste computacional y aun así realizar un análisis decente, cargamos los resultados obtenidos de una búsqueda similar con 200 iteraciones.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="n">model_random_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_distributions</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">model_random_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span></code></pre></div>
<pre><code>Fitting 5 folds for each of 200 candidates, totalling 1000 fits
CPU times: total: 39.7 s
Wall time: 1min 28s
</code></pre>
<style>#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 {color: black;background-color: white;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 pre{padding: 0;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-toggleable {background-color: white;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-estimator:hover {background-color: #d4ebff;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-item {z-index: 1;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-parallel-item:only-child::after {width: 0;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5 div.sk-text-repr-fallback {display: none;}</style><div id="sk-14b38d11-fbf7-43ba-a230-21f8dfbb7cc5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomizedSearchCV(cv=5,estimator=Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;,sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;,&#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;,&#x27;relationship&#x27;,&#x27;race&#x27;,&#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,Hi...&#x27;classifier__learning_rate&#x27;: &lt;scipy.stats._distn_infrastructure.rv_frozen object at 0x0000023201C853F0&gt;,&#x27;classifier__max_bins&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C86110&gt;,&#x27;classifier__max_leaf_nodes&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C86020&gt;,&#x27;classifier__min_samples_leaf&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C844F0&gt;},verbose=1)</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="26927545-9ed9-4507-8d82-ca84908bca10" type="checkbox" ><label for="26927545-9ed9-4507-8d82-ca84908bca10" class="sk-toggleable__label sk-toggleable__label-arrow">RandomizedSearchCV</label><div class="sk-toggleable__content"><pre>RandomizedSearchCV(cv=5,estimator=Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;,sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;,&#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;,&#x27;relationship&#x27;,&#x27;race&#x27;,&#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,Hi...&#x27;classifier__learning_rate&#x27;: &lt;scipy.stats._distn_infrastructure.rv_frozen object at 0x0000023201C853F0&gt;,&#x27;classifier__max_bins&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C86110&gt;,&#x27;classifier__max_leaf_nodes&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C86020&gt;,&#x27;classifier__min_samples_leaf&#x27;: &lt;__main__.loguniform_int object at 0x0000023201C844F0&gt;},verbose=1)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="26cc7c2c-7391-4299-a16b-1884c300ba7d" type="checkbox" ><label for="26cc7c2c-7391-4299-a16b-1884c300ba7d" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="44bcf83a-b6b5-43a0-8509-f4f20ecb8d9f" type="checkbox" ><label for="44bcf83a-b6b5-43a0-8509-f4f20ecb8d9f" class="sk-toggleable__label sk-toggleable__label-arrow">cat_preprocessor</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;, &#x27;native-country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e95e41a4-20eb-47c0-b782-dbf84244a0d4" type="checkbox" ><label for="e95e41a4-20eb-47c0-b782-dbf84244a0d4" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;, unknown_value=-1)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f9a376fe-a745-448b-b194-02528f5729fc" type="checkbox" ><label for="f9a376fe-a745-448b-b194-02528f5729fc" class="sk-toggleable__label sk-toggleable__label-arrow">remainder</label><div class="sk-toggleable__content"><pre></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cbc62a39-d65d-4fb1-9741-2b42a89e932f" type="checkbox" ><label for="cbc62a39-d65d-4fb1-9741-2b42a89e932f" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="56fcfad3-d61d-4aa8-aea7-b74d4a9ed5a2" type="checkbox" ><label for="56fcfad3-d61d-4aa8-aea7-b74d4a9ed5a2" class="sk-toggleable__label sk-toggleable__label-arrow">HistGradientBoostingClassifier</label><div class="sk-toggleable__content"><pre>HistGradientBoostingClassifier(max_leaf_nodes=4, random_state=42)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">accuracy</span> <span class="o">=</span> <span class="n">model_random_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;La puntuación de precisión de prueba del mejor modelo es: &#34;</span>
      <span class="n">f</span><span class="s2">&#34;{accuracy:.2f}&#34;</span><span class="p">)</span></code></pre></div>
<pre><code>La puntuación de precisión de prueba del mejor modelo es: 0.88
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">shorten_param</span><span class="p">(</span><span class="n">param_name</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&#34;__&#34;</span> <span class="ow">in</span> <span class="n">param_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">param_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&#34;__&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">param_name</span></code></pre></div>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">cv_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">model_random_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="s2">&#34;mean_test_score&#34;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">cv_results</span> <span class="o">=</span> <span class="n">cv_results</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">shorten_param</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cv_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<div class="table-container"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_score_time</th>
      <th>std_score_time</th>
      <th>l2_regularization</th>
      <th>learning_rate</th>
      <th>max_bins</th>
      <th>max_leaf_nodes</th>
      <th>min_samples_leaf</th>
      <th>params</th>
      <th>split0_test_score</th>
      <th>split1_test_score</th>
      <th>split2_test_score</th>
      <th>split3_test_score</th>
      <th>split4_test_score</th>
      <th>mean_test_score</th>
      <th>std_test_score</th>
      <th>rank_test_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>1.229856</td>
      <td>0.098360</td>
      <td>0.121906</td>
      <td>0.002678</td>
      <td>0.947496</td>
      <td>0.126528</td>
      <td>173</td>
      <td>21</td>
      <td>3</td>
      <td>{'classifier__l2_regularization': 0.9474964020...</td>
      <td>0.868705</td>
      <td>0.872782</td>
      <td>0.873191</td>
      <td>0.866912</td>
      <td>0.870325</td>
      <td>0.870383</td>
      <td>0.002388</td>
      <td>1</td>
    </tr>
    <tr>
      <th>186</th>
      <td>1.809153</td>
      <td>0.109481</td>
      <td>0.156434</td>
      <td>0.003111</td>
      <td>6.955393</td>
      <td>0.136036</td>
      <td>168</td>
      <td>32</td>
      <td>1</td>
      <td>{'classifier__l2_regularization': 6.9553925685...</td>
      <td>0.867886</td>
      <td>0.872236</td>
      <td>0.871007</td>
      <td>0.867731</td>
      <td>0.871690</td>
      <td>0.870110</td>
      <td>0.001920</td>
      <td>2</td>
    </tr>
    <tr>
      <th>195</th>
      <td>1.138879</td>
      <td>0.130649</td>
      <td>0.128410</td>
      <td>0.010519</td>
      <td>16.334498</td>
      <td>0.25793</td>
      <td>252</td>
      <td>16</td>
      <td>4</td>
      <td>{'classifier__l2_regularization': 16.334498052...</td>
      <td>0.868978</td>
      <td>0.872372</td>
      <td>0.870461</td>
      <td>0.864728</td>
      <td>0.871963</td>
      <td>0.869701</td>
      <td>0.002760</td>
      <td>3</td>
    </tr>
    <tr>
      <th>47</th>
      <td>1.520606</td>
      <td>0.067083</td>
      <td>0.144124</td>
      <td>0.011037</td>
      <td>0.253969</td>
      <td>0.040045</td>
      <td>138</td>
      <td>28</td>
      <td>8</td>
      <td>{'classifier__l2_regularization': 0.2539688800...</td>
      <td>0.866112</td>
      <td>0.871553</td>
      <td>0.869915</td>
      <td>0.865684</td>
      <td>0.868960</td>
      <td>0.868445</td>
      <td>0.002243</td>
      <td>4</td>
    </tr>
    <tr>
      <th>98</th>
      <td>0.409552</td>
      <td>0.040553</td>
      <td>0.064756</td>
      <td>0.010694</td>
      <td>0.000011</td>
      <td>0.955962</td>
      <td>222</td>
      <td>5</td>
      <td>4</td>
      <td>{'classifier__l2_regularization': 1.1497260106...</td>
      <td>0.860516</td>
      <td>0.870598</td>
      <td>0.868823</td>
      <td>0.866230</td>
      <td>0.864182</td>
      <td>0.866070</td>
      <td>0.003536</td>
      <td>5</td>
    </tr>
  </tbody>
</table></div>
</div>
<p>Como tenemos más de 2 parámetros en nuestra búsqueda aleatoria no podemos visualizar los resultados con un mapa de calor. Aún podríamos hacerlo por parejas, pero tener una proyección bidimensional de un problema multidimensional nos puede conducir a una interpresación errónea de las puntuaciones.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&#34;max_leaf_nodes&#34;</span><span class="p">:</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;max_leaf_nodes&#34;</span><span class="p">],</span>
        <span class="s2">&#34;learning_rate&#34;</span><span class="p">:</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;learning_rate&#34;</span><span class="p">],</span>
        <span class="s2">&#34;score_bin&#34;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
            <span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;mean_test_score&#34;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="s2">&#34;YlGnBu_r&#34;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&#34;max_leaf_nodes&#34;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&#34;learning_rate&#34;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s2">&#34;score_bin&#34;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&#34;k&#34;</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&#34;log&#34;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&#34;log&#34;</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&#34;mean_test_score&#34;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&#34;center left&#34;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span></code></pre></div>
<p><img src="/images/output_67_0.png" alt="png"></p>
<p>En el gráfico podemos ver que las mejores ejecuciones se encuentran en un rango de tasa de aprendizaje de entre 0.01 y 1.0, pero no tenemos control sobre cómo interactúan los otros hiperparámetros en la tasa de aprendizaje. En su lugar, podemos visualizar todos los hiperparámetros al mismo tiempo usando un gráfico de coordenadas paralelas.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;l2_regularization&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;l2_regularization&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float64&#34;</span><span class="p">)</span>
<span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;learning_rate&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;learning_rate&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float64&#34;</span><span class="p">)</span>
<span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;max_bins&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;max_bins&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float64&#34;</span><span class="p">)</span>
<span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;max_leaf_nodes&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;max_leaf_nodes&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float64&#34;</span><span class="p">)</span>
<span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;min_samples_leaf&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;min_samples_leaf&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;float64&#34;</span><span class="p">)</span></code></pre></div>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="kn">as</span> <span class="nn">px</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">parallel_coordinates</span><span class="p">(</span>
    <span class="n">cv_results</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">shorten_param</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&#34;learning_rate&#34;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">,</span>
            <span class="s2">&#34;max_leaf_nodes&#34;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">,</span>
            <span class="s2">&#34;max_bins&#34;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">,</span>
            <span class="s2">&#34;min_samples_leaf&#34;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">,</span>
            <span class="s2">&#34;l2_regularization&#34;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">,</span>
            <span class="s2">&#34;mean_test_score&#34;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&#34;mean_test_score&#34;</span><span class="p">,</span>
    <span class="n">color_continuous_scale</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">sequential</span><span class="o">.</span><span class="n">Viridis</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
<p><img src="/images/parallel_coordinates.png" alt=""></p>
<p>Transformamos la mayoría de los valores de los ejes tomando log10 o log2 para distribuir los rangos activos y mejorar la legibilidad del gráfico.</p>
<p>El gráfico de coordenadas paralelas muestra los valores de los hiperparámetros en diferentes columnas, mientras que la métrica de rendimiento está codificada por colores. Por tanto, somos capaces de inspeccionar rápidamente si existe un rango de hiperparámetros que funcionan o no.</p>
<p>Es posible <strong>seleccionar un rango de resultados haciendo clic y manteniendo presionado cualquier eje</strong> de coordenadas paralelas del gráfico. Luego podemos deslizar (mover) la selección del rango y cruzar dos selecciones para ver las interacciones. Podemos deshacer la selección haciendo clic una vez más en el mismo eje.</p>
<p>En particular para esta búsqueda de hiperparámetros, es interesante confirmar que las líneas amarillas (modelos de mejor rendimiento) alcanzan valores intermedios para la tasa de aprendizaje, es decir, valores entre las marcas -2 y 0 que corresponden a valores de tasa de aprendizaje de 0,01 y 1, una vez revertimos la transformación log10 para ese eje.</p>
<p>Pero ahora también podemos observar que no es posible seleccionar modelos de mayor rendimiento seleccionado líneas en el eje <code>max_bins</code> con valores de marcas entre 1 y 3.</p>
<p>Los otros hiperparámetros no son muy sensibles. Podemos comprobar que si seleccionamos en el eje <code>learning_rate</code> valores entre las marcas -1.5 y -0.5 y en el eje <code>max_bins</code> valores entre las marcas 5 y 8, siempre seleccionamos modelos con el mejor rendimiento, independientemente de los valores de los otros hiperparámetros.</p>
<h1 id="evaluación-y-ajuste-de-hiperparámetros"><a href="#evaluación-y-ajuste-de-hiperparámetros" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Evaluación y ajuste de hiperparámetros</h1>
<p>Hasta el momento hemosvisto dos enfoques para ajustar hiperparámetros. Sin embargo, no hemos presentado una forma apropiada para evaluar los modelos &ldquo;tuneados&rdquo;. En su lugar, nos hemos enfocado en el mecanismo usado para encontrar el mejor conjunto de hiperparámetros. Vamos a mostrar cómo evaluar modelos donde los hiperparámetros necesitan ser ajustados.</p>
<p>Partimos del mismo dataset, el cual hemos dividido en entrenamiento y prueba, y hemos realizado el mismo pipeline de preprocesado.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span></code></pre></div>
<style>#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 {color: black;background-color: white;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 pre{padding: 0;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-toggleable {background-color: white;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-estimator:hover {background-color: #d4ebff;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-item {z-index: 1;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-parallel-item:only-child::after {width: 0;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38 div.sk-text-repr-fallback {display: none;}</style><div id="sk-54bb3de2-7cb5-486a-8f57-b1d5847e7c38" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;,&#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,HistGradientBoostingClassifier(max_leaf_nodes=4,random_state=42))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a554dc3e-8327-4393-aff3-676c3eed6188" type="checkbox" ><label for="a554dc3e-8327-4393-aff3-676c3eed6188" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;,&#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,HistGradientBoostingClassifier(max_leaf_nodes=4,random_state=42))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="629b85b4-69bf-424e-93cf-dd00f03f62cc" type="checkbox" ><label for="629b85b4-69bf-424e-93cf-dd00f03f62cc" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b2b496b6-9d1e-4c7d-9e67-e12ffd778df3" type="checkbox" ><label for="b2b496b6-9d1e-4c7d-9e67-e12ffd778df3" class="sk-toggleable__label sk-toggleable__label-arrow">cat_preprocessor</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;, &#x27;native-country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c916ee38-c437-4019-a4e4-5c37c56de886" type="checkbox" ><label for="c916ee38-c437-4019-a4e4-5c37c56de886" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;, unknown_value=-1)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bee4ee51-3a02-4109-be6d-ce36fd35957d" type="checkbox" ><label for="bee4ee51-3a02-4109-be6d-ce36fd35957d" class="sk-toggleable__label sk-toggleable__label-arrow">remainder</label><div class="sk-toggleable__content"><pre></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c4c1e31e-9030-4c8a-9aa8-41c8552589c8" type="checkbox" ><label for="c4c1e31e-9030-4c8a-9aa8-41c8552589c8" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="578b75c1-e1a5-495b-b081-6186d59e65e1" type="checkbox" ><label for="578b75c1-e1a5-495b-b081-6186d59e65e1" class="sk-toggleable__label sk-toggleable__label-arrow">HistGradientBoostingClassifier</label><div class="sk-toggleable__content"><pre>HistGradientBoostingClassifier(max_leaf_nodes=4, random_state=42)</pre></div></div></div></div></div></div></div>
<h2 id="evaluación-sin-ajuste-de-hiperparámetros"><a href="#evaluación-sin-ajuste-de-hiperparámetros" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Evaluación sin ajuste de hiperparámetros</h2>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">cv_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cv_results</span><span class="p">)</span>
<span class="n">cv_results</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<div class="table-container"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.527953</td>
      <td>0.057048</td>
      <td>0.863036</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.525952</td>
      <td>0.051044</td>
      <td>0.860784</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.545971</td>
      <td>0.056046</td>
      <td>0.860360</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.491422</td>
      <td>0.052546</td>
      <td>0.863124</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.495926</td>
      <td>0.048542</td>
      <td>0.867219</td>
    </tr>
  </tbody>
</table></div>
</div>
<p>Las puntuaciones de validación cruzada provienen de 5-particiones. Entonces, podemos calcular la media y la desviación típica de la puntuación de generalización.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">print</span><span class="p">(</span>
    <span class="n">f</span><span class="s2">&#34;Puntuación de generalización sin ajuste de hiperparámetros:</span><span class="se">\n</span><span class="s2">&#34;</span>
    <span class="n">f</span><span class="s2">&#34;{cv_results[&#39;test_score&#39;].mean():.3f} +/- {cv_results[&#39;test_score&#39;].std():.3f}&#34;</span>
<span class="p">)</span></code></pre></div>
<pre><code>Puntuación de generalización sin ajuste de hiperparámetros:
0.863 +/- 0.003
</code></pre>
<h2 id="evaluación-con-ajuste-de-hiperparámetros"><a href="#evaluación-con-ajuste-de-hiperparámetros" class="anchor-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Evaluación con ajuste de hiperparámetros</h2>
<p>Vamos a presentar cómo evaluar el modelo con ajuste de hiperparámetros, lo que requiere un paso extra para seleccionar el mejor conjunto de parámetros. Ya vimos que podemos usar una estrategia de búsqueda que utiliza validación cruzada para encontrar el mejor conjunto de hiperparámetros. Aquí vamos a usar una estrategia de grid-search y reproduciremos los pasos que ya vimos anteriormente.</p>
<p>En primer lugar, vamos a incrustar nuestro modelo en un grid-search y especificar los parámetros y los valores de los parámetros que queremos explorar.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__learning_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="s1">&#39;classifier__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">model_grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
<span class="n">model_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code></pre></div>
<style>#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c {color: black;background-color: white;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c pre{padding: 0;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-toggleable {background-color: white;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-estimator:hover {background-color: #d4ebff;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-item {z-index: 1;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-parallel-item:only-child::after {width: 0;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-d91f18ac-4f33-4d2a-8157-7265844aee0c div.sk-text-repr-fallback {display: none;}</style><div id="sk-d91f18ac-4f33-4d2a-8157-7265844aee0c" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=2,estimator=Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;,sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;,&#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;,&#x27;relationship&#x27;,&#x27;race&#x27;,&#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,HistGradientBoostingClassifier(max_leaf_nodes=4,random_state=42))]),n_jobs=-1,param_grid={&#x27;classifier__learning_rate&#x27;: (0.05, 0.5),&#x27;classifier__max_leaf_nodes&#x27;: (10, 30)})</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="756e9d3e-1d44-4c6a-9165-ff2339417a8e" type="checkbox" ><label for="756e9d3e-1d44-4c6a-9165-ff2339417a8e" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=2,estimator=Pipeline(steps=[(&#x27;preprocessor&#x27;,ColumnTransformer(remainder=&#x27;passthrough&#x27;,sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;,&#x27;education&#x27;,&#x27;marital-status&#x27;,&#x27;occupation&#x27;,&#x27;relationship&#x27;,&#x27;race&#x27;,&#x27;sex&#x27;,&#x27;native-country&#x27;])])),(&#x27;classifier&#x27;,HistGradientBoostingClassifier(max_leaf_nodes=4,random_state=42))]),n_jobs=-1,param_grid={&#x27;classifier__learning_rate&#x27;: (0.05, 0.5),&#x27;classifier__max_leaf_nodes&#x27;: (10, 30)})</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="55b15c9c-916b-4063-a30b-1128e768e8f2" type="checkbox" ><label for="55b15c9c-916b-4063-a30b-1128e768e8f2" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;, sparse_threshold=0,transformers=[(&#x27;cat_preprocessor&#x27;,OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,unknown_value=-1),[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;,&#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;,&#x27;native-country&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8419c484-ab91-4477-9a3b-58f8ab96b4c7" type="checkbox" ><label for="8419c484-ab91-4477-9a3b-58f8ab96b4c7" class="sk-toggleable__label sk-toggleable__label-arrow">cat_preprocessor</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;education&#x27;, &#x27;marital-status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;race&#x27;, &#x27;sex&#x27;, &#x27;native-country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bee9b2a6-5cc8-4f64-9588-68d45d894bcf" type="checkbox" ><label for="bee9b2a6-5cc8-4f64-9588-68d45d894bcf" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;, unknown_value=-1)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c0ee9c94-e086-4657-9250-e9a548c1dba2" type="checkbox" ><label for="c0ee9c94-e086-4657-9250-e9a548c1dba2" class="sk-toggleable__label sk-toggleable__label-arrow">remainder</label><div class="sk-toggleable__content"><pre></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d36cd104-a615-43d9-8020-f201908cb0bd" type="checkbox" ><label for="d36cd104-a615-43d9-8020-f201908cb0bd" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9eed132e-c726-4274-93aa-6654ce99c4f8" type="checkbox" ><label for="9eed132e-c726-4274-93aa-6654ce99c4f8" class="sk-toggleable__label sk-toggleable__label-arrow">HistGradientBoostingClassifier</label><div class="sk-toggleable__content"><pre>HistGradientBoostingClassifier(max_leaf_nodes=4, random_state=42)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
<p>Como vimos, cuando llamamos al método <code>fit</code>, el modelo embebido en grid-search es entrenado con cada una de las posibles combinaciones de parámetros resultado del cuadrante de parámetros. Se selecciona la mejor combinación, manteniendo aquella combinación que conduce a la mejor puntuación media de validación cruzada.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">cv_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">model_grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
<span class="n">cv_results</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<div class="table-container"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_score_time</th>
      <th>std_score_time</th>
      <th>param_classifier__learning_rate</th>
      <th>param_classifier__max_leaf_nodes</th>
      <th>params</th>
      <th>split0_test_score</th>
      <th>split1_test_score</th>
      <th>mean_test_score</th>
      <th>std_test_score</th>
      <th>rank_test_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.603518</td>
      <td>0.013511</td>
      <td>0.260224</td>
      <td>0.006005</td>
      <td>0.05</td>
      <td>10</td>
      <td>{'classifier__learning_rate': 0.05, 'classifie...</td>
      <td>0.863970</td>
      <td>0.864707</td>
      <td>0.864338</td>
      <td>0.000369</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.898772</td>
      <td>0.002502</td>
      <td>0.319024</td>
      <td>0.004754</td>
      <td>0.05</td>
      <td>30</td>
      <td>{'classifier__learning_rate': 0.05, 'classifie...</td>
      <td>0.871013</td>
      <td>0.870317</td>
      <td>0.870665</td>
      <td>0.000348</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.300508</td>
      <td>0.036280</td>
      <td>0.163140</td>
      <td>0.023520</td>
      <td>0.5</td>
      <td>10</td>
      <td>{'classifier__learning_rate': 0.5, 'classifier...</td>
      <td>0.866426</td>
      <td>0.868679</td>
      <td>0.867553</td>
      <td>0.001126</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.261725</td>
      <td>0.007006</td>
      <td>0.152131</td>
      <td>0.001501</td>
      <td>0.5</td>
      <td>30</td>
      <td>{'classifier__learning_rate': 0.5, 'classifier...</td>
      <td>0.867164</td>
      <td>0.866836</td>
      <td>0.867000</td>
      <td>0.000164</td>
      <td>3</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model_grid_search</span><span class="o">.</span><span class="n">best_params_</span></code></pre></div>
<pre><code>{'classifier__learning_rate': 0.05, 'classifier__max_leaf_nodes': 30}
</code></pre>
<p>Una importante advertencia aquí es la concerniente a la evaluación del rendimiento de generalización. De hecho, la media y la desviación típica de las puntuaciones calculadas por la validación cruzada en grid-search no son potencialmente buenas estimaciones del rendimiento de generalización que obtendríamos reentrenando un modelo con la mejor combinación de valores de hiperparámetros en el dataset completo. Hay que tener en cuenta que scikit-learn, por defecto, ejecuta automáticamente este reentreno cuando llamamos a <code>model_grid_search.fit</code>. Este modelo reentrenado se entrena con más datos que los diferentes modelos entrenados internamente durante la validación cruzada de grid-search.</p>
<p>Por lo tanto, usamos el conocimiento del dataset completo para decidir los hiperparámetros de nuestro modelo y entrenar el modelo reajustado. Debido a esto, se debe mantener un conjunto de prueba externo para la evaluación final del modelo reajustado. Destacamos aquí el proceso usando una única división entrenamiento-prueba.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">model_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">model_grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Precisión en el conjunto de prueba: {accuracy:.3f}&#34;</span><span class="p">)</span></code></pre></div>
<pre><code>Precisión en el conjunto de prueba: 0.879
</code></pre>
<p>La medida de puntuación en el conjunto de prueba final está casi en el mismo rango que la puntuación de validación cruzada interna para la mejor combinación de hiperparámetros. Esto es tranquilizador, ya que significa que el procedimiento de ajuste no ha provocado un overfitting significativo en sí mismo (de lo contrario, la puntuación de prueba final habría sido más baja que la puntuación de validación cruzada interna). Eso era de esperar porque nuestro grid-search exploró muy pocas combinaciones de hiperparámetros en aras de la velocidad. La puntuación de prueba del modelo final es realmente un poco más alta de la que cabría esperar de la validación cruzada interna. Esto también era de esperar porque el modelo reajustado se entrena en un dataset más grande que los modelos evaluados en el bucle de validación cruzada interno del procedimiento de grid-search. Este suele ser el caso de los modelos entrenados con un gran número de instancias, tienden a generalizar mejor.</p>
<p>En el código anterior, la selección de los mejores hiperparámetros se realizó únicamente en el conjunto de entrenamiento de la división inicial entrenamiento-prueba. Después, evaluamos el rendimiento de generalización de nuestro modelo tuneado en el conjunto de prueba restante. Esto se puede mostrar esquemáticamente en el siguiente diagrama:</p>
<p><img src="/images/kfold_cv.png" alt=""></p>
<p>Esta figura muestra el caso particular de la estrategia de validación cruzada de <strong>K-particiones</strong> usando <code>n_splits=5</code> para dividir el conjunto de entrenamiento proveniente de la división entrenamient-prueba. Para cada división de validación cruzada, el procedimiento entrena un modelo en todas las instancias rojas, evalúa la puntuación de un conjunto dado de hiperparámetros en las instancias verdes. Los mejores hiperparámetros se seleccionan basándose en estas puntuaciones intermedias. El modelo final tuneado con esos hiperparámetros se entrena en la concatenación de instancias rojas y verdes y se evalúa en las instancias azules.</p>
<p>Las instancias verdes a menudo se denominan conjuntos de validación para diferenciarlos del conjunto de prueba final en azul.</p>
<p>Sin embargo, esta evaluación solo nos proporciona una estimación puntual única del rendimiento de generalización. Como recordamos al principio, es beneficioso disponer de una idea aproximada de la incertidumbre de nuestro rendimiento de generalización estimado. Por lo tanto, deberíamos usar adicionalmente una validación cruzada para esta estimación.</p>
<p>Este patrón se denomina <strong>validación-cruzada anidada</strong>. Usamos la validación cruzada interna para la selección de los hiperparámetros y la validación cruzada externa para la evaluación del rendimiento de generalización del modelo tuneado reajustado.</p>
<p>En la práctica, solo necesitamos incrustar grid-search en la función <code>cross-validate</code> para ejecutar dicha evaluación.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
    <span class="n">model_grid_search</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_estimator</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span></code></pre></div>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">cv_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cv_results</span><span class="p">)</span>
<span class="n">cv_test_scores</span> <span class="o">=</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;test_score&#34;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span>
    <span class="s2">&#34;Puntuación de generalización con ajuste de hiperparámetros:</span><span class="se">\n</span><span class="s2">&#34;</span>
    <span class="n">f</span><span class="s2">&#34;{cv_test_scores.mean():.3f} +/- {cv_test_scores.std():.3f}&#34;</span>
<span class="p">)</span></code></pre></div>
<pre><code>Puntuación de generalización con ajuste de hiperparámetros:
0.871 +/- 0.003
</code></pre>
<p>Este resultado es compatible con la puntuación de prueba medida en la división externa entrenamiento-prueba. Sin embargo, en este caso obtenemos conocimiento sobre la variablidad de nuestra estimación del rendimiento de generalización gracias a la medida de la desviación típica de las puntuaciones medidas en la validación cruzada externa.</p>
<p>A continuación se muestra una representación esquemática del procedimiento completo de validación cruzada anidada.</p>
<p><img src="/images/kf_cv_nested.png" alt=""></p>
<p>En la figura se ilustra la estrategia de validación cruzada anidada usando <code>cv_inner = Kfold(n_splits=4)</code> y <code>cv_outer = Kfold(n_splits=5)</code>.</p>
<p>Para cada división de validación cruzada interna (indexada en la parte izquierda), el procedimiento entrena un modelo en todas las muestras rojas y evalúa la calidad de los hiperparámetros en las muestras verdes.</p>
<p>Para cada división de validación cruzada externa (indexada en la parte derecha), se seleccionan los mejores hiperparámetros basándose en las puntuaciones de validación (calculadas en las muestras verdes) y se reajusta un modelo en la concatenación de las instancias rojas y verdes para esa iteración de validación cruzada externa.</p>
<p>El rendimiento de generalización de los 5 modelos reajustados del bucle de validación cruzada externa se evalúa en las instancias azules para obtener las puntuaciones finales.</p>
<p>Pasando el parámetro <code>return_estimator=True</code> podemos comprobar el valor de los mejores hiperparámetros obtenidos para cada partición de la validación cruzada externa.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">cv_fold</span><span class="p">,</span> <span class="n">estimator_in_fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&#34;estimator&#34;</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span>
        <span class="n">f</span><span class="s2">&#34;Mejores hiperparámetros para la partición nº{cv_fold+1}:</span><span class="se">\n</span><span class="s2">&#34;</span>
        <span class="n">f</span><span class="s2">&#34;{estimator_in_fold.best_params_}&#34;</span>
    <span class="p">)</span></code></pre></div>
<pre><code>Mejores hiperparámetros para la partición nº1:
{'classifier__learning_rate': 0.05, 'classifier__max_leaf_nodes': 30}
Mejores hiperparámetros para la partición nº2:
{'classifier__learning_rate': 0.05, 'classifier__max_leaf_nodes': 30}
Mejores hiperparámetros para la partición nº3:
{'classifier__learning_rate': 0.05, 'classifier__max_leaf_nodes': 30}
Mejores hiperparámetros para la partición nº4:
{'classifier__learning_rate': 0.5, 'classifier__max_leaf_nodes': 10}
Mejores hiperparámetros para la partición nº5:
{'classifier__learning_rate': 0.05, 'classifier__max_leaf_nodes': 30}
</code></pre>
<p>Es interesante ver si el procedimiento de ajuste de hiperparámetros siempre selecciona valores similares para los hiperparámetros. Si es el caso, entonces todo está bien. Significa que podemos desplegar un modelo ajustado con esos hiperparámetros y esperar que tenga un rendimiento predictivo real cercano al que medimos en la validación cruzada externa.</p>
<p>Pero también es posible que algunos hiperparámetros no tengan ninguna importancia y, como resultado de diferentes sesiones de ajuste, den resultados diferentes. En este caso, servirá cualquier valor. Normalmente esto se puede confirmar haciendo un gráfico de coordenadas paralelas de los resultados de una gran búsqueda de hiperparáemtros, como ya vimos.</p>
<p>Desde el punto de vista de la implementación, se podría optar por implementar todos los modelos encontrados en el ciclo de validación cruzada externa y votar para obtener las predicciones finales. Sin embargo, esto puede causar problemas operativos debido a que usa más memoria y hace que la predicción sea más lenta, lo que resulta en un mayor uso de recursos computacionales por predicción.</p>

            </div>

            
    
    
        <ul class="post-copyright">
            <li class="copyright-item author"><span class="copyright-item-text"></span><a href="https://sgtsteiner.github.io/" class="p-author h-card" target="_blank" rel="noopener">Antonio Méndez</a></li>
            
                
                
                
                
                <li class="copyright-item link"><span class="copyright-item-text"></span><a href="/posts/hyperparameters-tuning/" target="_blank" rel="noopener">https://sgtsteiner.github.io/posts/hyperparameters-tuning/</a></li>
            
            <li class="copyright-item license"><span class="copyright-item-text"></span><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></li>
            
        </ul>
    



        </article>

        

        
    <div class="updated-badge-container">
        <span title="Updated @ 2022-03-28 18:16:18 CEST" style="cursor:help">

<svg xmlns="http://www.w3.org/2000/svg" width="130" height="20" class="updated-badge"><linearGradient id="b" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><clipPath id="a"><rect width="130" height="20" rx="3" fill="#fff"/></clipPath><g clip-path="url(#a)"><path class="updated-badge-left" d="M0 0h55v20H0z"/><path class="updated-badge-right" d="M55 0h75v20H55z"/><path fill="url(#b)" d="M0 0h130v20H0z"/></g><g fill="#fff" text-anchor="middle" font-size="110"><text x="285" y="150" fill="#010101" fill-opacity=".3" textLength="450" transform="scale(.1)">updated</text><text x="285" y="140" textLength="450" transform="scale(.1)">updated</text><text x="915" y="150" fill="#010101" fill-opacity=".3" textLength="650" transform="scale(.1)">2022-03-28</text><text x="915" y="140" textLength="650" transform="scale(.1)">2022-03-28</text></g></svg>
        </span></div>



        


        <div class="post-share">

        

        <div class="share-items">

            
                <div class="share-item twitter">
                    
                    <a href="https://twitter.com/share?url=https://sgtsteiner.github.io/posts/hyperparameters-tuning/&amp;text=Ajuste%20de%20hiperpar%c3%a1metros&amp;hashtags=hiperpar%c3%a1metros,&amp;via=Steiner_69" title="" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon twitter-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a>
                </div>
            

            

            
                <div class="share-item linkedin">
                    
                    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://sgtsteiner.github.io/posts/hyperparameters-tuning/&amp;title=Ajuste%20de%20hiperpar%c3%a1metros&amp;summary=En%20posts%20anteriores%20vimos%20c%c3%b3mo%20crear,%20entrenar,%20predecir%20e%20incluso%20evaluar%20un%20modelo%20predictivo.%20Sin%20embargo,%20no%20cambiamos%20ninguno%20de%20los%20par%c3%a1metros%20del%20modelo%20que%20tenemos%20a%20nuestra%20disposici%c3%b3n%20cuando%20creamos%20una%20instancia.%20Por%20ejemplo,%20para%20k-nearest%20neighbors,%20inicialmente%20usamos%20los%20par%c3%a1metros%20por%20defecto:%20n_neighbors=5%20antes%20de%20probar%20otros%20par%c3%a1metros%20del%20modelo.&amp;source=Lords%20of%20the%20Machine%20Learning" title="" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon linkedin-icon"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg></a>
                </div>
            

            
                <div class="share-item telegram">
                    
                    <a href="https://t.me/share/url?url=https://sgtsteiner.github.io/posts/hyperparameters-tuning/&amp;text=Ajuste%20de%20hiperpar%c3%a1metros" title="" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon telegram-icon"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg></a>
                </div>
            

            

            

            

            

            
                <div class="share-item qrcode">
                    <div class="qrcode-container" title=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon qrcode-icon"><path d="M0 224h192V32H0v192zM64 96h64v64H64V96zm192-64v192h192V32H256zm128 128h-64V96h64v64zM0 480h192V288H0v192zm64-128h64v64H64v-64zm352-64h32v128h-96v-32h-32v96h-64V288h96v32h64v-32zm0 160h32v32h-32v-32zm-64 0h32v32h-32v-32z"/></svg><div id="qrcode-img"></div>
                    </div>
                    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>

<script>
    var typeNumber = 0;
    var errorCorrectionLevel = 'L';
    var qr = qrcode(typeNumber, errorCorrectionLevel);
    qr.addData('https:\/\/sgtsteiner.github.io\/posts\/hyperparameters-tuning\/');
    qr.make();
    document.getElementById('qrcode-img').innerHTML = qr.createImgTag();
</script>

                </div>
            

        </div>

    </div>




        
    
    
        <div class="related-posts">
            <h2 class="related-title"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"/></svg></h2>
            <ul class="related-list">
                
                    <li class="related-item">
                        <a href="/posts/selecting-best-model/" class="related-link">Selección del mejor modelo</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/predictive-modeling-pipeline/" class="related-link">Pipeline de modelado predictivo</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/30daysofml/" class="related-link">30 Days of ML</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/wine-quality-clasificacion-multiclase/" class="related-link">Calidad del vino - Clasificación multiclase</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/wine-quality-un-problema-de-regresion/" class="related-link">Calidad del vino - Un problema de regresión</a>
                    </li>
                
            </ul>
        </div>
    



        
    
        <div class="post-tags">
            
                
                
                
                
                    
                    <a href="/tags/hiperpar%C3%A1metros/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>hiperparámetros</a>
                
            
        </div>
    



        


        


        
    
        
        
    
    
    
    
        <ul class="post-nav">
            
            
                <li class="post-nav-next">
                    <a href="/posts/selecting-best-model/" rel="next">Selección del mejor modelo &gt;</a>
                </li>
            
        </ul>
    



        


    </div>
</main>


            
    <div id="back-to-top" class="back-to-top">
        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a>
    </div>


            
    <footer id="footer" class="footer">
        <div class="footer-inner">
            <div class="site-info">©&nbsp;2021–2022&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;Antonio Méndez</div><div class="site-copyright"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></div>

            
    
        <ul class="socials"><li class="socials-item">
                    <a href="/rss.xml" target="_blank" rel="external noopener" title="RSS"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"/></svg></a>
                </li><li class="socials-item">
                    <a href="mailto:futitotal@gmail.com" target="_blank" rel="external noopener" title="Email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://github.com/SgtSteiner" target="_blank" rel="external noopener" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://twitter.com/Steiner_69" target="_blank" rel="external noopener" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://t.me/SgtSteiner" target="_blank" rel="external noopener" title="Telegram"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon social-icon"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg></a>
                </li></ul>
    



            
        </div>
    </footer>


        </div>
        

        








    <script src="https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js"></script>

<script>
    mediumZoom(document.querySelectorAll('div.post-body img'), {
        background: 'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'
    })
</script>




    <script src="https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js" type="module" defer></script>







    </body>
</html>
